#TCP状态转换：</br>
![TCP状态转换](https://user-images.githubusercontent.com/37798962/88628960-3e51f900-d0e1-11ea-997d-3025f0d5821e.jpg)
![TCP状态转换释义](https://user-images.githubusercontent.com/37798962/88628966-40b45300-d0e1-11ea-8dfb-43bcce189f0d.jpg)
![TCP流程](https://user-images.githubusercontent.com/37798962/88631466-c554a080-d0e4-11ea-8fb6-628843c9ea8b.jpg)</br>
实线箭头表示：主动发起；
虚线箭头表示：被动接收；
细实线箭头：双方同时发起一个状态；

ESTABLISHED:说明三次握手完成
FIN_WAIT_2:说明主动发起关闭连接的处于半关闭状态；
TIME_WAIT:主动发起关闭请求的等待2MSL（约1min时间），确保主动发送端最后发送的ACK已经被对端收到。


#半关闭：
```
#include<sys/socket.h>
int shutdown(int sockfd,int how);
```
sockfd:需要关闭的socket的描述符
shutdown的操作（how的值）：
SHUT_RD(0):关闭sockfd上的读功能，此选项不允许sockfd进行读操作。
该套接字不再接收数据，任何当前在套接字接受缓冲区的数据都被丢弃。
SHUT_WR(1):关闭sockfd上的写功能，此选项不允许sockfd进行写操作，进程不能再对该套接字发出写操作。
SHUT_RDWR(2):关闭sockfd读写功能，相当于调用shutdown两次，首先是以SHUT_RD,然后SHUT_WR。
#2MSL：

#端口复用：
```
int getsockopt(int sockfd,int level,int optname,const void *optval,socklen_t optlen);

int setsockopt(int sockfd,int level,int optname,const void *optval,socklen_t optlen);
```
#多路I/O转接服务器：
##select
```
#include<sys/select.h>
#include<sys/time.h>
#include<sys/types.h>
#include<unistd.h>
int select(int nfds, fd_set *readfds,fd_set *writefds,fd_set *exceptfds, struct timeval *timeout);
```
nfds:所监听的文件描述符中，最大的文件描述符+1；
readfds,writefds,exceptfds：所监听的描述符可读、可写、异常事件；为传入传出参数
返回值： 成功：所监听的所有监听集合中满足条件的总数；（可读、可写、异常满足条件的总数）
        失败：

```
void FD_ZERO(fd_set *set);//将set清空 0
void FD_SET(int fd,fd_set *set);//将fd加入set集合中
void FD_CLR(int fd, fd_set *set);//将fd从set中清除出去
int FD_ISSET(int fd,fd_set *set);//判断fd是否在集合中
```
1. 文件描述符：最大上限1024个：
    即同时监听文件描述符最多只能有1024个
2. 若文件描述符为：1，1023 找到需要通过for（1->1023）
3. 监听集合
    满足监听条件的集合
    将原有集合保存
最开始监听lfd的集合为readfds，因为服务器在等待读客户端请求；
##poll
```
#include<poll.h>
int poll(struct pollfd* fds,nfds_t nfds,int timeout);//timeout是毫秒级
struct pollfd{
    int fd;     //file descriptor
    short events;       //requested events（POLLIN/POLLOUT/POLLERR）
    short revents;      //returned events（是传出参数不用定义：POLLIN/POLLOUT/POLLERR）
};
```
优点： 可以使用多于1024个文件描述符
      监听、返回集合    分离
      搜索范围小
##epoll